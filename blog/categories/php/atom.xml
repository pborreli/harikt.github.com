<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Php | Random thoughts | Hari KT]]></title>
  <link href="http://harikt.com/blog/categories/php/atom.xml" rel="self"/>
  <link href="http://harikt.com/"/>
  <updated>2014-05-12T21:12:00+05:30</updated>
  <id>http://harikt.com/</id>
  <author>
    <name><![CDATA[Hari K T]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Web Routing in PHP With Aura.Router]]></title>
    <link href="http://harikt.com/blog/2014/04/26/web-routing-in-php-with-aura-dot-router/"/>
    <updated>2014-04-26T20:30:10+05:30</updated>
    <id>http://harikt.com/blog/2014/04/26/web-routing-in-php-with-aura-dot-router</id>
    <content type="html"><![CDATA[<p>It took sometime for me to create a series of screencast on
<a href="http://auraphp.com">aura</a>. So my plan to start a series of
screencasts starts with <a href="https://github.com/auraphp/Aura.Router">Aura.Router</a>
version 2.</p>

<p><div class="embed-video-container"><iframe src="http://www.youtube.com/embed/hBV_BKP1WIY "></iframe></div></p>

<p>Yes, I have made some mistakes, but I do love to hear your feedback
and interest for the future screencast.</p>

<p>The next one will be on <a href="https://github.com/auraphp/Aura.Dispatcher">Dispatcher</a>
If you want to cover something special in the
<a href="https://github.com/auraphp/Aura.Dispatcher">Dispatcher</a> I will try to
address it.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Aura Dispatcher in Silex]]></title>
    <link href="http://harikt.com/blog/2013/11/06/using-aura-dispatcher-in-silex/"/>
    <updated>2013-11-06T12:42:00+05:30</updated>
    <id>http://harikt.com/blog/2013/11/06/using-aura-dispatcher-in-silex</id>
    <content type="html"><![CDATA[<p>2 days back <a href="http://paul-m-jones.com/">Paul M Jones</a> wrote an awesome post
<a href="http://auraphp.com/blog/2013/11/04/aura-v2-dispatcher/">A Peek At Aura v2 &mdash; Aura.Dispatcher</a>
the idea behind <a href="http://github.com/auraphp/Aura.Dispatcher/">Aura.Dispatcher</a>
and how it was born.</p>

<p>So today, let us try to integrate
<a href="http://github.com/auraphp/Aura.Dispatcher">Aura.Dispatcher</a> with
<a href="https://github.com/silexphp/Silex">Silex</a>. This post is inspired by the
<a href="http://auraphp.com/blog/2013/11/04/aura-v2-dispatcher/#comment-1109657910">comment</a>
made by <a href="https://twitter.com/cordoval">Luis Cordova</a>. Thank you.</p>

<p><code>bash
composer create-project silex/silex --no-dev silexproject
cd silexproject
composer require aura/dispatcher dev-develop-2
</code></p>

<blockquote><p>I hope you have composer installed else <a href="http://getcomposer.org/">get composer</a>.</p></blockquote>

<p>I am not going to explain each and everything, the code is self explanatory.
You can move the classes according to your wish (may be to another folder).
I am trying to show a simple use case.</p>

<p>```php
&lt;?php
require <strong>DIR</strong> . &lsquo;/vendor/autoload.php&rsquo;;</p>

<p>use Aura\Dispatcher\Dispatcher;</p>

<p>$dispatcher = new Dispatcher;</p>

<p>$dispatcher->setMethodParam(&lsquo;action&rsquo;);
$dispatcher->setObjectParam(&lsquo;controller&rsquo;);</p>

<p>class Blog
{</p>

<pre><code>public function browse()
{
    // ...
}

public function hello($name, $app)
{
    return 'Hello '. ucfirst($app-&gt;escape($name));
}

public function edit($id)
{
    echo "Here";
    exit;
    // ...
}

public function add()
{
    // ...
}

public function delete($id)
{
    // ...
}
</code></pre>

<p>}</p>

<p>$dispatcher->setObject(&lsquo;blog&rsquo;, function () {</p>

<pre><code>return new Blog;
</code></pre>

<p>});</p>

<p>$app = new Silex\Application();</p>

<p>$app->get(&lsquo;/hello/{name}&rsquo;, function ($name) use ($dispatcher, $app) {</p>

<pre><code>$params = [
    'controller' =&gt; 'blog',
    'action' =&gt; 'hello',
    'name' =&gt; $name,
    'app' =&gt; $app,
];
$result = $dispatcher-&gt;__invoke($params);    
return $result;
</code></pre>

<p>});</p>

<p>$app->run();
```</p>

<p>See how we moved the <code>return 'Hello '. ucfirst($app-&gt;escape($name));</code>
to a controller and action. I haven&rsquo;t used Silex extensively, so there
can be better ways for integration.</p>

<blockquote><p>Update : I was asking <a href="https://twitter.com/beausimensen">Beau D. Simensen</a>
on the integration, and he gave another shot.</p></blockquote>

<p>```php
// all code as same as above, upto the route</p>

<p>$app->get(&lsquo;/hello/{name}&rsquo;, function ($name) use ($app) {</p>

<pre><code>return [
    'controller' =&gt; 'blog',
    'action' =&gt; 'hello',
    'name' =&gt; $name,
    'app' =&gt; $app,
];
</code></pre>

<p>});</p>

<p>$app->on(\Symfony\Component\HttpKernel\KernelEvents::VIEW, function ($event) use ($app, $dispatcher) {</p>

<pre><code>$view = $event-&gt;getControllerResult();

if (is_null($view) || is_string($view)) {
    return;
}

if ( ! is_array($view)) {
    // we can only handle array data in the view
    return;
}

if (! (isset($view['controller']) &amp;&amp; isset($view['action']))) {
    // at this point we don't know what is going on.
    return;
}

$response = $dispatcher($view);

if ( ! $response instanceof \Symfony\Component\HttpFoundation\Response) {
    // If the response is not a Response instance, wrap it in one
    // and assume that it was something appropriate as a response
    // body.
    $response = new \Symfony\Component\HttpFoundation\Response($response);
}

$event-&gt;setResponse($response);
</code></pre>

<p>});</p>

<p>$app->run();
```</p>

<blockquote><p>I have purposefully kept the full path like <code>\Symfony\Component\HttpFoundation\Response</code></p></blockquote>

<p>Hope you love <a href="http://github.com/auraphp/Aura.Dispatcher">Aura.Dispatcher</a>
and use when you need architecural changes.</p>

<p>Please do take time to read
<a href="https://github.com/auraphp/Aura.Dispatcher#refactoring-to-architecture-changes">Refactoring To Architecture Changes</a></p>

<p>Thank you and if you loved the post please do a tweet :&ndash;).</p>

<p>Happy PhPing!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Looking at Aura Version 2]]></title>
    <link href="http://harikt.com/blog/2013/09/28/looking-at-aura-v2/"/>
    <updated>2013-09-28T06:53:00+05:30</updated>
    <id>http://harikt.com/blog/2013/09/28/looking-at-aura-v2</id>
    <content type="html"><![CDATA[<p>If you have noticed recently, there have been tons of commits from
<a href="https://github.com/pmjones">Paul M Jones</a>ï»¿ for aura version 2.</p>

<p>More standalone repos born. Everyone should try and give feedback as much as possible.</p>

<p>Interesting stuffs split from Aura.Sql v 1.3 are</p>

<p><a href="https://github.com/auraphp/Aura.Sql/tree/develop-2">Extended PDO</a>,</p>

<p>As the name says, it is an extended version of PDO. Good thing is it is
PHP 5.3 compatible.</p>

<p>If you have worked with PDO you know the good and bad.
One of the difficulty is, it cannot use an array for an in clause.</p>

<p>```php
&lt;?php
// the array to be quoted
$array = array(&lsquo;foo&rsquo;, &lsquo;bar&rsquo;, &lsquo;baz&rsquo;);</p>

<p>// the statement to prepare
$stm = &lsquo;SELECT * FROM test WHERE foo IN (:foo) AND bar = :bar&rsquo;</p>

<p>// the native PDO way does not work (PHP Notice:  Array to string conversion)
$pdo = new Pdo(&hellip;);
$sth = $pdo->prepare($stm);
$sth->bindValue(&lsquo;foo&rsquo;, $array);
```</p>

<p>ExtendedPDO helps you to do it.</p>

<p>```php
&lt;?php
$pdo = new ExtendedPdo(&hellip;);
$stm = &lsquo;SELECT * FROM test WHERE foo IN (:foo)&rsquo;;
$pdo->bindValues(array(</p>

<pre><code>'foo' =&gt; array('foo', 'bar', 'baz'),
'bar' =&gt; 'qux',
</code></pre>

<p>));
$sth = $pdo->prepare($stm);
echo $sth->queryString;
```</p>

<p>Try out an example, and see in action.</p>

<p>Your composer.json will look as</p>

<p>```json
{</p>

<pre><code>"minimum-stability": "dev",
"require": {
    "aura/sql":"dev-develop-2"
}
</code></pre>

<p>}
```</p>

<p>Run the below Sql query in your favourite tools like phpmyadmin or adminer.</p>

<p>```sql
&mdash; Adminer 3.7.1 MySQL dump</p>

<p>SET NAMES utf8;
SET foreign_key_checks = 0;
SET time_zone = &lsquo;+05:30&rsquo;;
SET sql_mode = &lsquo;NO_AUTO_VALUE_ON_ZERO&rsquo;;</p>

<p>DROP TABLE IF EXISTS <code>polls_choice</code>;
CREATE TABLE <code>polls_choice</code> (
  <code>id</code> int(11) NOT NULL AUTO_INCREMENT,
  <code>poll_id</code> int(11) NOT NULL,
  <code>choice_text</code> varchar(200) NOT NULL,
  <code>votes</code> int(11) NOT NULL,
  PRIMARY KEY (<code>id</code>)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</p>

<p>INSERT INTO <code>polls_choice</code> (<code>id</code>, <code>poll_id</code>, <code>choice_text</code>, <code>votes</code>) VALUES
(1, 1,  &lsquo;Not much&rsquo;, 0),
(2, 1,  &lsquo;The sky&rsquo;,  0),
(5, 1,  &lsquo;Hello World&rsquo;,  0);</p>

<p>&mdash; 2013-09-28 11:22:17
```</p>

<p>Run the below PHP code and see the result.</p>

<p>```php
&lt;?php
require <strong>DIR</strong> . &lsquo;/vendor/autoload.php&rsquo;;</p>

<p>use Aura\Sql\ExtendedPdo;
use Aura\Sql\Profiler;</p>

<p>$pdo = new ExtendedPdo(</p>

<pre><code>'mysql:host=localhost;dbname=dbname',
'user',
'password',
array(), // driver options as key-value pairs
array()  // attributes as key-value pairs
</code></pre>

<p>);
$pdo->setProfiler(new Profiler);
$pdo->getProfiler()&ndash;>setActive(true);</p>

<p>$stm = &lsquo;SELECT * FROM polls_choice WHERE id IN (:id) AND poll_id = :poll_id&rsquo;;</p>

<p>$bind = array(</p>

<pre><code>'id' =&gt; array('1', '2'),
'poll_id' =&gt; '1',
</code></pre>

<p>);
$results = $pdo->fetchAll($stm, $bind);</p>

<p>foreach ($results as $result) {
  echo &ldquo;Query Result : &rdquo; . $result[&lsquo;choice_text&rsquo;] . PHP_EOL;
}</p>

<p>echo &ldquo;Profiler&rdquo; . PHP_EOL;</p>

<p>$profiles = $pdo->getProfiler()&ndash;>getProfiles();</p>

<p>foreach ($profiles as $profile) {
  echo &lsquo; Function : &rsquo; . $profile[&lsquo;function&rsquo;] . PHP_EOL;
  echo &lsquo; Duration : &rsquo; . $profile[&lsquo;duration&rsquo;] . PHP_EOL;
  echo &lsquo; Statement : &rsquo; . $profile[&lsquo;statement&rsquo;] . PHP_EOL;
  echo &lsquo; Bind Values : &rsquo; . print_r($profile[&lsquo;bind_values&rsquo;], true) . PHP_EOL;
}
```</p>

<p>It comes with lazy connection, profiler, connection locator etc. Read more from
<a href="https://github.com/auraphp/Aura.Sql/tree/develop-2#getting-started">getting started docs</a></p>

<h2><a href="https://github.com/auraphp/Aura.Sql_Schema">Aura.Sql_Schema</a></h2>

<p>An independent schema discovery tool for MySQL, PostgreSQL,
SQLite, and Microsoft SQL Server. You can
<a href="https://github.com/auraphp/Aura.Sql_Schema#getting-started">read more from the docs</a></p>

<h2><a href="https://github.com/auraphp/Aura.Sql_Query">Aura.Sql_Query</a></h2>

<p>Independent query builders for MySQL, PostgreSQL, SQLite, and Microsoft SQL Server</p>

<p>Good thing is all are standalone.</p>

<p>Version 2 also comes with a new
<a href="https://github.com/auraphp/Aura.Dispatcher">Dispatcher</a>
and <a href="https://github.com/auraphp/Aura.Includer">Includer</a>.</p>

<p>You can read the story behind Dispatcher from
<a href="https://groups.google.com/d/msg/auraphp/hyjEPEeo6_w/u616Pu3kQrcJ">here</a>
and Includer from
<a href="https://groups.google.com/d/msg/auraphp/WOo6TSceqHU/ZdgIkUgU0VIJ">here</a></p>

<p>vi <a href="https://github.com/auraphp/Aura.Includer">Includer</a>
aura solved one of the problem of reading configuration files.</p>

<p>Let us look into the example of the Aura.Includer and how it works.</p>

<p>The <code>composer.json</code> looks like the one below.</p>

<p>```json
{</p>

<pre><code>"minimum-stability": "dev",
"require": {
    "aura/cli": "dev-develop-2",
    "aura/web": "dev-develop-2",
    "aura/autoload": "dev-develop-2",
    "aura/dispatcher": "dev-develop-2",
    "aura/html": "dev-master",
    "aura/input": "dev-master",
    "aura/view": "2.*",
    "aura/includer": "dev-develop-2",
    "aura/router": "dev-develop",
    "aura/di": "1.*"
}
</code></pre>

<p>}
```</p>

<p>We can use the includer to read the configuration files and store it and
later use the cached file. The <code>includer.php</code> looks like</p>

<p>```php
&lt;?php
$loader = require <strong>DIR</strong> . &lsquo;/vendor/autoload.php&rsquo;;</p>

<p>$includer = new \Aura\Includer\Includer();</p>

<p>$includer->setDirs(array(</p>

<pre><code>__DIR__ . '/vendor/aura/router',
__DIR__ . '/vendor/aura/dispatcher',
__DIR__ . '/vendor/aura/web',
__DIR__ . '/vendor/aura/view',
__DIR__ . '/vendor/aura/html',
__DIR__ . '/vendor/aura/cli',
__DIR__ . '/vendor/aura/input',
</code></pre>

<p>));</p>

<p>$includer->setFiles(array(</p>

<pre><code>'config/default.php',
</code></pre>

<p>));</p>

<p>use Aura\Router\Map;
use Aura\Router\DefinitionFactory;
use Aura\Router\RouteFactory;</p>

<p>$router = new Map(new DefinitionFactory, new RouteFactory);</p>

<p>use Aura\Di\Container;
use Aura\Di\Forge;
use Aura\Di\Config;</p>

<p>$di = new Container(new Forge(new Config));</p>

<p>$includer->setVars(array(</p>

<pre><code>'loader' =&gt; $loader,
'router' =&gt; $router,
'di' =&gt; $di,
</code></pre>

<p>));</p>

<p>if (! file_exists(<strong>DIR</strong> . &lsquo;/cache/includer.php&rsquo;)) {</p>

<pre><code>$includer-&gt;load();
$text = $includer-&gt;read();
file_put_contents(__DIR__ . '/cache/includer.php', '&lt;?php' . PHP_EOL . $text);
</code></pre>

<p>} else {</p>

<pre><code>$includer-&gt;setCacheFile(__DIR__ . '/cache/includer.php');
$includer-&gt;load();
</code></pre>

<p>}
$stdio = $di->newInstance(&lsquo;Aura\Cli\Stdio&rsquo;);
$stdio->outln(&lsquo;This is normal text.&rsquo;);
```</p>

<p>Install the dependencies via <code>composer</code> and run via cli <code>php includer.php</code>.</p>

<p>The Aura.Includer is a nice addition for version 2
( I am also seeing it can be used in version 1 )
which will help a lot in the making of the framework with the libraries.</p>

<p>If you are interested to use, learn, or have a feedback a warm welcome to
<a href="https://groups.google.com/forum/#!forum/auraphp">join the google group for aura project for PHP</a></p>

<p>Have a nice day ahead. Enjoy PHPing.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Chance to Win Free Copies of Packtâs New Book on Zend Framework 2.0]]></title>
    <link href="http://harikt.com/blog/2013/08/23/chance-to-win-free-copies-of-packts-new-book-on-zend-framework-2-dot-0/"/>
    <updated>2013-08-23T11:59:00+05:30</updated>
    <id>http://harikt.com/blog/2013/08/23/chance-to-win-free-copies-of-packts-new-book-on-zend-framework-2-dot-0</id>
    <content type="html"><![CDATA[<p>I have teamed up with <a href="http://www.packtpub.com">Packt Publishing</a> to organize a contest
of its newly published book on
<a href="http://www.packtpub.com/zend-framework-2-0-by-example-beginners-guide/book">Zend Framework 2.0 by example</a></p>

<p>And 3 lucky winners stand a chance to win eBook copies of the book.
Keep reading to find out how you can be one of the Lucky Winners.</p>

<h2>Overview of the book</h2>

<ul>
<li><p> Master application development with Zend Framework 2.0</p></li>
<li><p> Learn about Zend Framework components and use them for functions such as searching, image
processing, and payment gateway integrations</p></li>
<li><p> Integrate third-party services for media sharing and payment processing</p></li>
</ul>


<h2>How to Enter ?</h2>

<p>All you need to do is head on over to the
<a href="http://www.packtpub.com/zend-framework-2-0-by-example-beginners-guide/book">book page</a>
and look through the product description of the book and drop a line via the
comments below this post to let us know what interests you the most about this book.
Itâs that simple.</p>

<p>Deadline:The contest will close in 1 weeks time (ie 30th August 2013).
Winners will be contacted by email, so be sure to use your real email
address when you comment! Hurry up as you could be one of the few lucky
ones to get yourself a free ebook of the latest released title.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Connecting to Magento via SOAP]]></title>
    <link href="http://harikt.com/blog/2013/07/12/connecting-to-magento-via-soap/"/>
    <updated>2013-07-12T14:12:00+05:30</updated>
    <id>http://harikt.com/blog/2013/07/12/connecting-to-magento-via-soap</id>
    <content type="html"><![CDATA[<p>In my earlier post I have shown how you can connect to Magento
with REST api. In this post let us connect via SOAP.</p>

<p>The below class acts like a proxy to call the magento soap api.</p>

<p>```php
&lt;?php
/<em>*
 *
 * @author Hari K T
 *
 </em>/
class My_Soap_Magento
{</p>

<pre><code>/**
 * 
 * Host name to connect
 * 
 * @var string
 * 
 */
protected $hostname;

/**
 * 
 * User name
 * 
 * @var string
 * 
 */
protected $username;

/**
 * 
 * API Key
 * 
 * @var string
 * 
 */
protected $apikey;

/**
 * 
 * Zend_Soap_Client
 * 
 * @var Zend_Soap_Client
 * 
 */
protected $client;


protected $session;

/**
 * 
 * Constructor
 * 
 * @param string $hostname The host name
 * 
 * @param string $username The user name of the host
 * 
 * @param string $apikey The apikey of the host
 * 
 */
public function __construct($hostname, $username, $apikey)
{        
    $this-&gt;hostname = $hostname;
    $this-&gt;username = $username;
    $this-&gt;apikey   = $apikey;        
}

/**
 * 
 * Magic method, the methods are named on the basis of Magento SOAP api
 * You don't need to pass the session as the first argument, for convience.
 * 
 * @link http://www.magentocommerce.com/api/soap/introduction.html
 * 
 * @param string $function
 * 
 * @param mixed $args
 * 
 * @return string | null
 * 
 */
public function __call($function, $args)
{
    $session = $this-&gt;getSession();
    $params = array_merge(array($this-&gt;getSession()), $args);
    $result = call_user_func_array(array($this-&gt;getClient(), $function), $params);
    if ($result) {
        // I need to get as json
        return Zend_Json_Encoder::encode($result);
    }
    return null;
}        

/**
 * 
 * Get the session from logging in to the Magento server
 * 
 * @return string
 * 
 */
public function getSession()
{
    if (! $this-&gt;session) {
        try {
            $this-&gt;session = $this-&gt;getClient()-&gt;login($this-&gt;username, $this-&gt;apikey);
        } catch (Exception $e) {

        }
    }
    return $this-&gt;session; 
}

/**
 * 
 * If we already have a session, we can set the session so it don't 
 * need to login again and get the session. This helps to reduce the 
 * call for login . 
 * 
 * @see getSession()
 * 
 * @param string $session
 * 
 * @return IM_Soap_Magento
 * 
 */
public function setSession($session)
{
    $this-&gt;session = $session;
    return $this;
}

/**
 * 
 * Get the Zend_Soap_Client object
 * 
 * @return Zend_Soap_Client
 * 
 */
public function getClient()
{
    if (! $this-&gt;client) {
        $endpoint  = trim($this-&gt;hostname, '/') . '/api/v2_soap/?wsdl';
        $this-&gt;client = new Zend_Soap_Client(            
            $endpoint
        );
    }     
    return $this-&gt;client;   
}
</code></pre>

<p>}
```</p>

<p>In order to connect you want to create an object of the above
class <code>My_Soap_Magento</code>. You need to get the username and api key
from the magento host.</p>

<p>```php
$object = new My_Soap_Magento(</p>

<pre><code>'the-magento-host',
'username',
'apikey'
</code></pre>

<p>);
```</p>

<p>Now you are done! You can connect to the soap api version 2 of
Magento server.</p>

<p>Sample how to get the product information, category tree,
category information, products list etc are shown below.</p>

<p>See we are not passing the session parameter.</p>

<p>```php
echo &ldquo;Product Info&rdquo;;
$result = $proxy->catalogProductInfo(16);
echo $result;</p>

<p>echo &ldquo;Category Tree&rdquo;;
$result = $proxy->catalogCategoryTree();
echo $result;</p>

<p>echo &ldquo;Category Info&rdquo;;
$result = $proxy->catalogCategoryInfo(10);
echo $result;</p>

<p>echo &lsquo;Products List&rsquo;;
$result = $proxy->catalogProductList();
echo $result;
```</p>
]]></content>
  </entry>
  
</feed>
